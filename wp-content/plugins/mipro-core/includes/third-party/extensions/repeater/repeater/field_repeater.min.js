(function(a){redux.field_objects=redux.field_objects||{};redux.field_objects.repeater=redux.field_objects.repeater||{};a(document).ready(function(){});redux.field_objects.repeater.sort_repeaters=function(k){k.hasClass("redux-container-repeater")||(k=k.parents(".redux-container-repeater:first"));k.find(".redux-repeater-accordion-repeater").each(function(f){var d=a(this).attr("data-sortid");a(this).find("input[name*='["+d+"]']").each(function(){a(this).attr("name",a(this).attr("name").replace("["+d+
"]","["+f+"]"))});a(this).find("select[name*='["+d+"]']").each(function(){a(this).attr("name",a(this).attr("name").replace("["+d+"]","["+f+"]"))});a(this).attr("data-sortid",f);var b=a(this).find(".ui-accordion-header"),g=b.attr("id").split("-header-");b.attr("id",g[0]+"-header-"+f);g=b.attr("aria-controls").split("-panel-");b.attr("aria-controls",g[0]+"-panel-"+f);b=a(this).find(".ui-accordion-content");g=b.attr("id").split("-panel-");b.attr("id",g[0]+"-panel-"+f);g=b.attr("aria-labelledby").split("-header-");
b.attr("aria-labelledby",g[0]+"-header-"+f)})};redux.field_objects.repeater.init=function(k){k||(k=a(document).find(".redux-group-tab:visible").find(".redux-container-repeater:visible"));a(k).each(function(f){var d=a(this),b=d;d.hasClass("redux-field-container")||(b=d.parents(".redux-field-container:first"));if(!b.is(":hidden")&&b.hasClass("redux-field-init")){b.removeClass("redux-field-init");b=d;d.hasClass("redux-field-container")||(b=d.parents(".redux-field-container:first"));f=b.attr("data-id");
var g=d.find(".redux-repeater-accordion-repeater:last-child");redux.repeater[f].blank=g.clone().wrap("<p>").parent().html();b.hasClass("redux-container-repeater")&&b.addClass("redux-field-init");b.hasClass("redux-field-init")&&(b.removeClass("redux-field-init"),b=d.find(".redux-repeater-accordion").accordion({header:"> div > fieldset > h3",collapsible:!0,activate:function(c,e){a.redux.initFields()},heightStyle:"content",icons:{header:"ui-icon-plus",activeHeader:"ui-icon-minus"}}),1==redux.repeater[f].sortable?
b.sortable({axis:"y",handle:"h3",connectWith:".redux-repeater-accordion",placeholder:"ui-state-highlight",start:function(c,e){e.placeholder.height(e.item.height());e.placeholder.width(e.item.width())},stop:function(c,e){e.item.children("h3").triggerHandler("focusout");redux.field_objects.repeater.sort_repeaters(a(this))}}):b.find("h3.ui-accordion-header").css("cursor","pointer"),d.find(".redux-repeater-accordion-repeater .bind_title").on("change keyup",function(c){c=0<a(c.target).find(":selected").text().length?
a(c.target).find(":selected").text():a(c.target).val();a(this).closest(".redux-repeater-accordion-repeater").find(".redux-repeater-header").text(c)}),d.on("click",".redux-repeaters-remove",function(){redux_change(a(this));var c=a(this).parents(".redux-container-repeater:first"),e=c.attr("data-id");redux.repeater[e].blank=a(this).parents(".redux-repeater-accordion-repeater:first").clone(!0,!0);a(this).parents(".redux-repeater-accordion-repeater:first").slideUp("medium",function(){a(this).remove();
redux.field_objects.repeater.sort_repeaters(d);""!=redux.repeater[e].limit&&c.find(".redux-repeater-accordion-repeater").length<redux.repeater[e].limit&&c.find(".redux-repeaters-add").removeClass("button-disabled");c.find(".redux-repeater-accordion-repeater:last .ui-accordion-header").trigger("click")})}),String.prototype.reduxReplaceAll=function(c,e){return this.replace(new RegExp(c.replace(/[.^$*+?()[{\|]/g,"\\$&"),"g"),e)},d.find(".redux-repeaters-add").click(function(){if(!a(this).hasClass("button-disabled")){var c=
a(this).parent().find(".redux-repeater-accordion:first"),e=c.find(".redux-repeater-accordion-repeater").length,l=c.attr("data-id");if(""!=redux.repeater[l].limit&&e>=redux.repeater[l].limit)a(this).addClass("button-disabled");else{e++;var n=c.find(".redux-repeater-accordion-repeater").size();c.find(".redux-repeater-accordion-repeater:last").find(".ui-accordion-header").hasClass("ui-state-active")&&c.find(".redux-repeater-accordion-repeater:last").find(".ui-accordion-header").click();var h=c.find(".redux-repeater-accordion-repeater:last").clone(!0,
!0);0==h.length&&(h=redux.repeater[l].blank);if(redux.repeater[l]){redux.repeater[l].count=d.find(".redux-repeater-header").length;var p=redux.repeater[l].html.reduxReplaceAll("99999",n);a(h).find(".redux-repeater-header").text("")}h.find(".ui-accordion-content").html(p);a(c).append(h);redux.field_objects.repeater.sort_repeaters(h);h=a(this).parent().find(".redux-repeater-accordion:first");h.find(".redux-repeater-accordion-repeater:last .ui-accordion-header").click();h.find(".redux-repeater-accordion-repeater:last .bind_title").on("change keyup",
function(m){m=0<a(m.target).find(":selected").text().length?a(m.target).find(":selected").text():a(m.target).val();a(this).closest(".redux-repeater-accordion-repeater").find(".redux-repeater-header").text(m)});0<redux.repeater[l].limit&&e>=redux.repeater[l].limit&&a(this).addClass("button-disabled")}}}))}})}})(jQuery);